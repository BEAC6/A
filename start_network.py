#!/usr/bin/env python3
"""
🌐 نشر منصة المسابقات الرياضية على الشبكة المحلية
Network deployment for math competition platform
"""

import subprocess
import sys
import webbrowser
import time
import socket

def get_local_ip():
    """الحصول على عنوان IP المحلي للجهاز"""
    try:
        # إنشاء اتصال وهمي للحصول على IP المحلي
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s.connect(("8.8.8.8", 80))
        local_ip = s.getsockname()[0]
        s.close()
        return local_ip
    except:
        return "192.168.1.156"  # IP افتراضي

def create_network_access_guide(ip_address):
    """إنشاء دليل الوصول للشبكة المحلية"""
    guide_content = f"""# 🌐 دليل الوصول للشبكة المحلية - منصة المسابقات الرياضية

## 🎉 **تم نشر التطبيق بنجاح على الشبكة المحلية!**

التطبيق الآن متاح لجميع الأجهزة المتصلة بنفس الشبكة المحلية.

---

## 📍 **عناوين الوصول للتطبيق**

### 🖥️ **من الجهاز المضيف (جهازك):**
- **الرابط المحلي**: http://localhost:8000
- **الرابط بـ IP**: http://{ip_address}:8000

### 📱 **من الأجهزة الأخرى في الشبكة:**
- **الرابط الرئيسي**: http://{ip_address}:8000

---

## 🎯 **روابط مباشرة للوصول السريع**

### 👨‍🏫 **للمعلمين والإداريين:**
- **تسجيل دخول المعلمين**: http://{ip_address}:8000/accounts/login/
- **لوحة الإدارة**: http://{ip_address}:8000/admin/

### 👥 **للطلاب:**
- **تسجيل دخول الطلاب**: http://{ip_address}:8000/student/login/
- **رمز دخول الطلاب**: `ben25`

---

## 🔑 **بيانات تسجيل الدخول**

### 👨‍💼 **حساب المدير/المعلم:**
- **اسم المستخدم**: `admin`
- **كلمة المرور**: `[محجوبة لأغراض الأمان]`
- **البريد الإلكتروني**: `admin@example.com`

### 👥 **دخول الطلاب:**
- **رمز الدخول**: `ben25`
- لا يحتاج اسم مستخدم أو كلمة مرور

---

## 📱 **كيفية الوصول من الأجهزة المختلفة**

### 🖥️ **من أجهزة الكمبيوتر:**
1. افتح أي متصفح ويب (Chrome, Firefox, Edge, Safari)
2. اكتب في شريط العنوان: `http://{ip_address}:8000`
3. اضغط Enter

### 📱 **من الهواتف الذكية:**
1. افتح متصفح الهاتف
2. اكتب في شريط العنوان: `http://{ip_address}:8000`
3. اضغط على زر الذهاب

### 💻 **من الأجهزة اللوحية:**
1. افتح متصفح الجهاز اللوحي
2. اكتب في شريط العنوان: `http://{ip_address}:8000`
3. اضغط Enter أو زر الذهاب

---

## 🔧 **معلومات تقنية**

### 🌐 **إعدادات الشبكة:**
- **عنوان IP للخادم**: {ip_address}
- **المنفذ**: 8000
- **البروتوكول**: HTTP
- **نوع الشبكة**: شبكة محلية (LAN)

### ⚙️ **إعدادات الخادم:**
- **إطار العمل**: Django 5.2.1
- **قاعدة البيانات**: SQLite
- **الخادم**: Django Development Server
- **الوضع**: Development Mode

---

## 🛡️ **الأمان والوصول**

### ✅ **الأجهزة المسموح لها بالوصول:**
- جميع الأجهزة المتصلة بنفس الشبكة المحلية
- أجهزة الكمبيوتر في نفس المكتب/المنزل
- الهواتف الذكية المتصلة بنفس الـ WiFi
- الأجهزة اللوحية في نفس الشبكة

### ❌ **الأجهزة غير المسموح لها:**
- الأجهزة خارج الشبكة المحلية
- الأجهزة المتصلة بشبكات أخرى
- الوصول من الإنترنت العام

---

## 📋 **خطوات الاستخدام**

### 👨‍🏫 **للمعلمين:**
1. اذهب إلى: http://{ip_address}:8000/accounts/login/
2. سجل دخولك بحساب المعلم
3. ابدأ في إنشاء المسابقات وإدارة الطلاب

### 👥 **للطلاب:**
1. اذهب إلى: http://{ip_address}:8000/student/login/
2. أدخل رمز الدخول: `ben25`
3. ابدأ في حل المسابقات المتاحة

---

## 🎯 **نصائح للاستخدام الأمثل**

### 📱 **للأجهزة المحمولة:**
- استخدم الوضع الأفقي للشاشات الأكبر
- تأكد من اتصال WiFi قوي
- أغلق التطبيقات الأخرى لتحسين الأداء

### 🖥️ **لأجهزة الكمبيوتر:**
- استخدم متصفح حديث للحصول على أفضل تجربة
- فعل JavaScript للحصول على جميع الميزات
- استخدم شاشة كاملة للمسابقات

---

## 🚨 **استكشاف الأخطاء**

### ❌ **إذا لم يتمكن جهاز من الوصول:**
1. تأكد من اتصال الجهاز بنفس الشبكة
2. تحقق من عنوان IP: `{ip_address}`
3. تأكد من أن الخادم يعمل
4. جرب إعادة تشغيل المتصفح

### 🔧 **إذا كان الاتصال بطيء:**
1. تحقق من قوة إشارة WiFi
2. أغلق التطبيقات غير المستخدمة
3. جرب متصفح مختلف

---

## 📊 **حالة الخادم**

### ✅ **الخادم يعمل حالياً:**
- **الحالة**: 🟢 متصل ويعمل
- **العنوان**: http://0.0.0.0:8000
- **متاح على**: جميع واجهات الشبكة
- **عنوان IP**: {ip_address}

### 📈 **إحصائيات:**
- **إطار العمل**: Django 5.2.1
- **وضع التطوير**: مفعل
- **مراقبة الملفات**: مفعلة
- **إعادة التحميل التلقائي**: مفعلة

---

## 🌟 **مبروك!**

**التطبيق الآن متاح لجميع الأجهزة في الشبكة المحلية! 🎉**

شارك عنوان IP مع المستخدمين: **http://{ip_address}:8000**
"""
    
    with open("NETWORK_ACCESS_GUIDE.md", "w", encoding="utf-8") as f:
        f.write(guide_content)

def main():
    print("🌐 منصة المسابقات الرياضية - النشر على الشبكة المحلية")
    print("=" * 60)
    print()
    
    # الحصول على عنوان IP المحلي
    local_ip = get_local_ip()
    print(f"🔍 تم اكتشاف عنوان IP: {local_ip}")
    print()
    
    try:
        # تحضير قاعدة البيانات
        print("📊 تحضير قاعدة البيانات...")
        subprocess.run([sys.executable, "manage.py", "migrate"], check=True)
        
        # تجميع الملفات الثابتة
        print("📁 تجميع الملفات الثابتة...")
        subprocess.run([sys.executable, "manage.py", "collectstatic", "--noinput"], check=True)
        
        # إنشاء دليل الوصول للشبكة
        print("📋 إنشاء دليل الوصول للشبكة المحلية...")
        create_network_access_guide(local_ip)
        
        print()
        print("🚀 بدء تشغيل الخادم على الشبكة المحلية...")
        print("🌐 متاح على جميع واجهات الشبكة")
        print(f"🏠 الرابط المحلي: http://localhost:8000")
        print(f"🌍 رابط الشبكة: http://{local_ip}:8000")
        print(f"👥 رابط التلاميذ: http://{local_ip}:8000/student/login/")
        print(f"👨‍🏫 رابط الأساتذة: http://{local_ip}:8000/accounts/login/")
        print("🔑 رمز دخول التلاميذ: ben25")
        print()
        print("📋 تم إنشاء دليل الوصول: NETWORK_ACCESS_GUIDE.md")
        print("⏹️ لإيقاف الخادم: اضغط Ctrl+C")
        print("=" * 60)
        print()
        
        # انتظار قليل ثم فتح المتصفح
        time.sleep(2)
        try:
            webbrowser.open(f'http://{local_ip}:8000')
            print("🌐 تم فتح المتصفح تلقائياً")
        except:
            print(f"📋 افتح المتصفح يدوياً على: http://{local_ip}:8000")
        
        print()
        print("🎯 شارك هذا الرابط مع المستخدمين:")
        print(f"   http://{local_ip}:8000")
        print()
        
        # تشغيل Django على جميع واجهات الشبكة
        subprocess.run([sys.executable, "manage.py", "runserver", "0.0.0.0:8000"])
        
    except KeyboardInterrupt:
        print("\n✅ تم إيقاف الخادم")
    except Exception as e:
        print(f"❌ خطأ: {e}")
        input("اضغط Enter للخروج...")

if __name__ == "__main__":
    main()
